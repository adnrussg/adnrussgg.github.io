<!-- This html uses local storage, Cart page -->
<!doctype html>
<html lang="en">
    <head>
        <style>
            #dropdownhover:hover .dropdown-menu{
                display: block;
            }
            .dropdown-menu{
                margin-top: 0;
            }
        </style>
        <title>Computer World Superstore</title>
        <link rel="shortcut icon" type="icon" href="../img/CWLogo.png" />
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap -->
        <link href="../css/bootstrap.css" rel="stylesheet">
        <!-- Bootstrap-ecommerce -->
        <link href="../css/bootstrap.css v=2.0.css" rel="stylesheet" type="text/css" />
        <link href="../css/ui.css v=2.0.css" rel="stylesheet" type="text/css" />
        <link href="../css/responsive.css v=2.0.css" rel="stylesheet" media="only screen and (max-width: 1200px)" />
        
        <!-- fonticon -->
        <link href="../fontawesomecss/all.css" rel="stylesheet" type="text/css" />
        <link href="../fontawesomecss/fontawesome.min.css" type="text/css" rel="stylesheet">
        
        <!-- Custom styling -->
        <link href="../css/assets_css_style.css v=2.0.css" rel="stylesheet" />
        <!-- plugin: fancybox  -->
        <link href="../customcss/jquery.fancybox.css" type="text/css" rel="stylesheet">
    </head>
    <body>
        <!-- HeadNavbar -->
        <header class="section-header">
            <section class="header-top-light border-bottom bg-primary">
                <div class="container">
                    <nav class="d-flex flex-column flex-md-row">
                        <ul class="nav mr-auto d-none d-md-flex">
                            <li><a href="https://www.facebook.com/ComputerWorldSuperstore/?ref=page_internal"
                                    class="nav-link px-2"> <i class="fab fa-facebook"></i> </a></li>
                            <li><a class="nav-link px-2" style="color: white;"> <i class="fas fa-phone-alt"></i> 0933 035 2587
                                </a></li>
                        </ul>
                        <ul class="nav">
                            <li class="nav-item"><a href="about.html" class="nav-link"> About Us </a></li>
                            <li class="nav-item"><a href="#" class="nav-link"> Delivery </a></li>
                            <li class="nav-item"><a href="#" class="nav-link"> Help </a></li>
                        </ul>
                    </nav>
                </div>
            </section>
        
            <section class="header-main border-bottom">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-2 col-6">
                            <a href="home.html" class="brand-wrap">
                                <img class="img-sm" src="../img/CWLogo.png" style="width: 60px; height: 60px;">
                            </a>
                        </div>
                        <div class="col-lg-6 col-sm-12 col-12">
                            <form action="#" class="search">
                                <div class="input-group w-100">
                                    <input type="text" class="form-control" placeholder="Search">
                                    <div class="input-group-append">
                                        <button class="btn btn-primary" type="submit">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-lg-4 colsm-6 col-12">
                            <div class="widgets-wrap float-md-right">
                                <a href="#" class="widget-header mr-2">
                                    <div class="icon">
                                        <i class="icon-sm rounded-circle border"><i class="fas fa-shopping-cart"></i></i>
                                        <span class="notify">0</span>
                                    </div>
                                </a>
                                <div class="widget-header dropdown">
                                    <a href="#" data-toggle="dropdown" data-offset="20,10">
                                        <div class="icontext">
                                            <div class="icon">
                                                <i class="icon-sm rounded-circle border"><i class="fa fa-user"></i></i>
                                            </div>
                                            <div class="text">
                                                <small class="text-muted">Hello, Sign in</small>
                                                <div>My account <i class="fa fa-caret-down"></i> </div>
                                            </div>
                                        </div>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <form class="px-4 py-3">
                                            <div class="form-group">
                                                <label>Email address</label>
                                                <input type="email" class="form-control" placeholder="email@example.com">
                                            </div>
                                            <div class="form-group">
                                                <label>Password</label>
                                                <input type="password" class="form-control" placeholder="Password">
                                            </div>
                                            <button type="submit" class="btn btn-primary">Sign in</button>
                                        </form>
                                        <hr class="dropdown-divider">
                                        <a class="dropdown-item" href="#">Have account? Sign up</a>
                                        <a class="dropdown-item" href="#">Forgot password?</a>
                                    </div> 
                                </div> 
                            </div> 
                        </div> 
                    </div>
                </div> 
            </section> 
            <!-- SubNavbar -->
            <nav class="navbar navbar-main navbar-expand-xl border-bottom">
                <div class="container">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_nav5"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="main_nav5">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="home.html"><strong>Home</strong></a>
                            </li>
                            <li class="nav-item dropdown" id="dropdownhover">
                                <a class="nav-link" data-toggle="dropdown" href="#"><strong>Brands</strong></a>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Acer</a>
                                    <a class="dropdown-item" href="#">AMD</a>
                                    <a class="dropdown-item" href="#">Asus</a>
                                    <a class="dropdown-item" href="#">Intel</a>
                                    <a class="dropdown-item" href="#">Lenovo</a>
                                    <a class="dropdown-item" href="#">Western Digital</a>
                                </div>
                            </li>
                            <li class="nav-item dropdown" id="dropdownhover">
                                <a class="nav-link" data-toggle="dropdown" href="#"><strong>Categories</strong></a>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Laptop</a>
                                    <a class="dropdown-item" href="#">Motherboard, Video Card & Processor</a>
                                    <a class="dropdown-item" href="#">Casing, Monitor & Power Supply</a>
                                    <a class="dropdown-item" href="#">Accessories</a>
                                </div>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="productlist.html"><strong>Shop</strong></a>
                            </li>
                        </ul>
                    </div> 
                </div> 
            </nav>
            <!-- End SubNavbar// -->
        </header>
        <!-- END HeadNavbar -->

        <section class="section-pagetop bg">
            <div class="container">
                <h2 class="title-page">Shopping cart</h2>
            </div> 
        </section>

        <div class="container ifEmpty"></div>

        <!-- Products Checkout -->
        <section class="section-content padding-y">
            <div class="container">
                <div class="row">
                    <main class="col-md-9">
                        <div class="card">
                            <table class="table table-borderless table-shopping-cart">
                                <thead class="text-muted">
                                    <tr class="small text-uppercase">
                                        <th scope="col">Product</th>
                                        <th scope="col" width="120">Quantity</th>
                                        <th scope="col" width="120">Price</th>
                                        <th scope="col" class="text-right" width="200"> </th>
                                    </tr>
                                </thead>
                                <tbody class="products">
                                </tbody>
                            </table>
                            <div class="card-body border-top">
                                <a href="#" class="btn btn-primary float-md-right"> Proceed to Checkout <i class="fa fa-chevron-right"></i> </a>
                                <a href="productlist.html" class="btn btn-light"> <i class="fa fa-chevron-left"></i> Continue shopping </a>
                            </div>
                        </div>
                    </main>
                    <aside class="col-md-3">
                        <div class="card mb-3">
                            <div class="card-body">
                                <form>
                                    <div class="form-group">
                                        <label>Have coupon?</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="" placeholder="Coupon code">
                                            <span class="input-group-append">
                                                <button class="btn btn-primary">Apply</button>
                                            </span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card ThetotalCost">
                            <div class="card-body">
                                <div id="prices-list">
                                    
                                </div>
                                <hr>
                                <p class="text-center mb-3">
                                    <img src="../img/payments.png" height="26">
                                </p>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="section-footer border-top bg" id="fp">
            <div class="container">
                <section class="footer-top  padding-y">
                    <div class="row">
                        <aside class="col-md-4 col-12">
                            <article class="mr-md-4">
                                <h5 class="title">Contact us</h5>
                                <p>"Our Name Speaks For Our Business"</p>
                                <ul class="list-icon">
                                    <li> <i class="icon fa fa-map-marker"> </i>Roxas Ave., Corner Padre Gomez Street, Barangay
                                        34-D Poblacion 8000 Davao City, Philippines </li>
                                    <li> <i class="icon fa fa-envelope"> </i> computerworld@gmail.com</li>
                                    <!-- Sample Email of CW -->
                                    <li> <i class="icon fa fa-phone"> </i> (082) 222-4058, (082) 227-6132</li>
                                    <li> <i class="icon fa fa-clock"> </i>Mon-Sat 9:00am - 6:00pm</li>
                                </ul>
                            </article>
                        </aside>
                        <aside class="col-md col-6">
                            <h6 class="title">Who We Are?</h6>
                            <ul class="list-unstyled">
                                <li> <a href="about.html">About us</a></li>
                                <li> <a href="https://www.google.com/maps/search/?api=1&query=7.070110200762624, 125.61473827864309&query_place_id=ChIJkYxMXpxt-TIR6Uu0PMKIzgw">Locate
                                        Us</a></li>
                            </ul>
                        </aside>
                        <aside class="col-md col-6">
                            <h6 class="title">Need Help?</h6>
                            <ul class="list-unstyled">
                                <li> <a href="https://www.messenger.com/t/1558316877724712/">Contact us</a></li>
                            </ul>
                        </aside>
                        <aside class="col-md col-6">
                            <h6 class="title">Account</h6>
                            <ul class="list-unstyled">
                                <li> <a href="cart.html"> My Orders </a></li>
                            </ul>
                        </aside>
                        <aside class="col-md">
                            <h6 class="title">Social</h6>
                            <ul class="list-unstyled">
                                <li><a href="https://www.facebook.com/ComputerWorldSuperstore/?ref=page_internal"> <i
                                            class="fab fa-facebook"></i> Facebook </a></li>
                            </ul>
                        </aside>
                    </div> 
                </section> 
        
                <section class="footer-bottom border-top row">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-8">
                                <span class="pr-2">&copy 2020 Computer World Superstore All Rights Reserved</span>
                                <span class="pr-2"><a href="#">Privacy policy</a></span>
                                <span class="pr-2"><a href="#">Terms of use</a></span>
                            </div>
                            <div class="col-md-4 text-md-right">
                                <span class="pr-2">Philippines</span>
                                <i class="fab fa-lg fa-cc-visa"></i>
                                <i class="fab fa-lg fa-cc-paypal"></i>
                                <i class="fab fa-lg fa-cc-mastercard"></i>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </footer>
        <!-- FOOTER END -->

        <!-- BootstrapEcommerceJS -->
        <script src="../js/jquery-3.5.1.slim.min.js" type="text/javascript"></script>
        <script src="../js/ecommerce_bootstrap.bundle.min.js" type="text/javascript"></script>
        <script src="../js/script.js" type="text/javascript"></script>
        <!-- FancyBox -->
        <script src="../customjs/jquery.fancybox.js" type="text/javascript"></script>
        <!-- BootstrapJS -->
        <script src="../js/bootstrap.bundle.min.js"></script>
        <!-- FontAwesomeJS -->
        <script defer src="../fontawesomejs/all.js"></script>
        <script defer src="../fontawesomejs/brands.js"></script>
        <script defer src="../fontawesomejs/solid.js"></script>
        <script defer src="../fontawesomejs/fontawesome.js"></script>
        <!-- SubNavbar Hover -->
        <script>
            $(document).ready(function () {
                $("#dropdownhover").hover(function () {
                    var dropdownMenu = $(this).children(".dropdown-menu");
                    if (dropdownMenu.is(":visible")) {
                        dropdownMenu.parent().toggleClass("open");
                    }
                });
            });
        </script>
        <!-- Local Storage Functions -->
        <!-- Ideas from Stackoverflow and Youtube -->
        <script src="../customjs/main.js"></script>
        <script>
            function saveCurrentProductView(index) {
                var ProductDetails = window.localStorage;
                ProductDetails.setItem("currentIndex", index);
                window.location.href = "./productview.html";
            }
            
            function productPriceTemplate(item) {
                return `
                    <div class="price-wrap">
                        <var class="price">₱${item.inCart * item.price}.00</var>
                        <small class="text-muted">₱${item.price}.00</small>
                    </div> <!-- price-wrap .// -->
                `;
            }

            function productTemplate(item) {
                return `
                    <tr class="product-cart-item" id="product-${item.tag}">
                        <td>
                            <figure class="itemside" id="product-click-${item.tag}" style="cursor: pointer;">
                                <div class="aside"><img src="../img/${item.image}" class="img-sm"></div>
                                <figcaption class="info">
                                    <a href="#" onclick="event.preventDefault();" class="title text-dark">${item.productname}</a>
                                </figcaption>
                            </figure>
                        </td>
                        <td>
                            <div class="form-row">
                                <div class="form-group col-md flex-grow-0">
                                    <div class="input-group mb-3 input-spinner">
                                        <div class="input-group-prepend">
                                            <button class="btn btn-light" type="button" id="button-minus-${item.tag}"> - </button>
                                        </div>
                                        <input type="text" class="form-control" id="quantity-number-${item.tag}" value=${item.inCart} readonly style="background-color: white;">
                                        <div class="input-group-append">
                                            <button class="btn btn-light" type="button" id="button-plus-${item.tag}"> + </button>
                                        </div>
                                    </div>
                                </div> <!-- col.// -->
                            </div> <!-- row.// -->
                        </td>
                        <td id="product-price-section-${item.tag}">
                            ${ productPriceTemplate(item) }
                        </td>
                        <td class="text-right">
                            <a href="" class="btn btn-light" onclick="removeItem(event, ${item.tag})"> <i class="far fa-times-circle"></i></a>
                        </td>
                    </tr>
                `;
            }

            function totalCostTemplate(cartCost) {
                return `
                    <dl class="dlist-align">
                        <dt>Total price:</dt>
                        <dd class="text-right">₱${cartCost}.00</dd>
                    </dl>
                    <dl class="dlist-align">
                        <dt>Discount:</dt>
                        <dd class="text-right">₱0.00</dd>
                    </dl>
                    <dl class="dlist-align">
                        <dt>Total:</dt>
                        <dd class="text-right  h5"><strong>₱${cartCost}.00</strong></dd>
                    </dl>
                `;
            };

            function cartEmptyTemplate() {
                return `
                    <div class="justify-content-center pt-lg-5 text-center">
                        <div>
                            <h2 class="h3">Add items to your cart first.</h2>
                        </div>
                    </div>
                `;
            }

            function removeItem(e, tag) {
                e.preventDefault();

                let cartItems = localStorage.getItem("productsInCart");
                cartItems = JSON.parse(cartItems);
                document.getElementById(`product-${tag}`).remove();
                delete cartItems[tag];
                localStorage.setItem("productsInCart", JSON.stringify(cartItems));

                printCartNumber();
                checkIfEmpty();
                updatePrices(tag);
            }

            function checkIfEmpty() {
                let cartItems = localStorage.getItem("productsInCart");
                cartItems = JSON.parse(cartItems);
                let ifEmpty = document.querySelector(".ifEmpty");

                if (JSON.stringify(cartItems) === JSON.stringify({}) || cartItems === null) {
                    ifEmpty.innerHTML = cartEmptyTemplate();
                }
            }

            function updatePrices(tag) {
                let cartItems = localStorage.getItem("productsInCart");
                cartItems = JSON.parse(cartItems);

                if (tag in cartItems) {
                    document.getElementById(`product-price-section-${tag}`).innerHTML = productPriceTemplate(cartItems[tag]);
                }
                
                let ThetotalCost = document.querySelector("#prices-list");
                let cartCost = 0;

                Object.values(cartItems).map(item => {
                    cartCost = cartCost + (item.inCart * item.price);
                });
                ThetotalCost.innerHTML = totalCostTemplate(cartCost);
            }

            function addQuantity(tag) {
                let cartItems = localStorage.getItem("productsInCart");
                cartItems = JSON.parse(cartItems);
                cartItems[tag].inCart += 1;
                document.getElementById(`quantity-number-${tag}`).value = cartItems[tag].inCart;

                localStorage.setItem("productsInCart", JSON.stringify(cartItems));

                printCartNumber();
                updatePrices(tag);
            }

            function subtractQuantity(tag) {
                let cartItems = localStorage.getItem("productsInCart");
                cartItems = JSON.parse(cartItems);
                if (cartItems[tag].inCart > 1) {
                    cartItems[tag].inCart -= 1;
                }
                document.getElementById(`quantity-number-${tag}`).value = cartItems[tag].inCart;

                localStorage.setItem("productsInCart", JSON.stringify(cartItems));

                printCartNumber();
                updatePrices(tag);
            }

            function displayCart() {
                let cartItems = localStorage.getItem("productsInCart");
                cartItems = JSON.parse(cartItems);
                let productContainer = document.querySelector(".products");
                let ThetotalCost = document.querySelector("#prices-list");
                let cartCost = 0;

                productContainer.innerHTML = '';
                Object.values(cartItems).map(item => {
                    cartCost = cartCost + (item.inCart * item.price);
                    productContainer.innerHTML += productTemplate(item);
                });
                
                Object.values(cartItems).map(item => {
                    document.getElementById(`product-click-${item.tag}`).addEventListener('click', () => saveCurrentProductView(item.tag - 1));
                    document.getElementById(`button-minus-${item.tag}`).addEventListener('click', () => subtractQuantity(item.tag));
                    document.getElementById(`button-plus-${item.tag}`).addEventListener('click', () => addQuantity(item.tag));
                });
                ThetotalCost.innerHTML = totalCostTemplate(cartCost);

                checkIfEmpty();
            }
            displayCart();
        </script>
    </body>
</html>